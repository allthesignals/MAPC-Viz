<!doctype html>
<html lang="en">
<meta charset="utf-8" content="50"/>
<link href="lib/bootstrap.css" rel="stylesheet" type="text/css">
<link href="chart-styles.css" rel="stylesheet" type="text/css">
<head>
	<meta charset="UTF-8">
	<title>Reuseability</title>
</head>
<body>
<div class="charts">
  <div id="line-graph"></div>
	<div id="chart4"></div>
	<div id="chart5"></div>
  <div id="chart3"></div>
  <div id="grouped-bar-chart-real-data"></div>
  <div id="grouped-bar-chart-real-data2"></div>
</div>
<script src="lib/d3.v3.js"></script>
<script src="lib/d3.chart.min.js"></script>
<script src="lib/miso.ds.deps.ie.0.4.1.js"></script>
<script src="lib/jquery.js"></script>
<script src="lib/bootstrap-tooltip.js"></script>
<script src="lib/bootstrap-popover.js"></script>
<!-- <script src="lib/d3.chart.base.js"></script> -->
<script src="lib/MAPCviz.js"></script>
<script>



var ds = new Miso.Dataset({
  url : 'data/edattain_by_race_puma.csv',
  delimiter : ',',
  columns: [{ name: 'Year', type: 'string' }]
});

ds.fetch({
  success : function() {
    var config = { 
          path: 'data/edattain_by_race_puma.csv',
          data: ['% Adults with an associate or bachelor degree']  
        , series: 'Puma Type'
        , errorflag: ', margin of error'
        , where: {
            column: 'year',
            value: '2007-11'
          }
        , groupBy: {

          }
        , countBy: {

          }
        }

	  var cut = ds.where({ columns: config.data, rows: function(row) { return row[config.where.column] == config.where.value }})
	  var output = [];

	  (this.countBy('Puma Type')).each(function(unique, index) {
	    var values = [];
	    var dynamicCut = ds.where({ columns: ['Puma Type', 'Year', '% Adults with an associate or bachelor degree', '% Adults with an associate or bachelor degree, margin of error']
	        , rows: function(row) { return row['Puma Type'] ==  unique['Puma Type']}  })

	    dynamicCut.each(function (row, rowIndex) {
	      values.push({ name: row['Year'], value: row['% Adults with an associate or bachelor degree'], error: row['% Adults with an associate or bachelor degree, margin of error'] })
	    })
	    output.push({ series: unique['Puma Type'], values: values})
	  });

    var groupedBarChart = d3.select("#grouped-bar-chart-real-data")
      .append("svg")
      .chart("GroupedBarChart");

    groupedBarChart.draw(output);


    var groupedBarChart = d3.select("#grouped-bar-chart-real-data2")
      .append("svg")
      .chart("GroupedBarChart");

    groupedBarChart.draw(output);

  },
  error : function() {
    console.log("Failure loading data")
  }
});



var lineChart = new Miso.Dataset({
  url : 'data/edattain_by_msa.csv',
  delimiter : ','
});

lineChart.fetch({
  success : function() {

  var chart, 
      config = { 
        path: 'data/edattain_by_msa.csv',
        data: ['Associate Degree or Higher'], 
        series: 'MSA Name', 
        errorflag: '', 
        where: {
          column: '',
          value: ''
        }
      }

  // we need to structure our data, from the dataset, into something d3 understanlineChart.
  var output = []; // empty box
  var parseDate = d3.time.format("%Y").parse;
  var cut = lineChart.where({ rows: function(row) { return row['Rank By Population'] <= 10 }});

  (cut.countBy('MSA Name')).each(function(unique, index) {
    var values = []
    var dynamicCut = lineChart.where({ columns: ['MSA Name', 'Associate Degree or Higher', 'Year'], rows: function(row) { return row['MSA Name'] == unique['MSA Name'] }})

    dynamicCut.each(function(row, rowIndex) {
      values.push({ year: parseDate(row['Year'].toString()), value: row['Associate Degree or Higher']})
    });
      output.push({series: unique['MSA Name'], values: values});
    
  });

  var chart = d3.select("#line-graph")
    .append("svg")
    .chart("LineChart")
    .callouts(["Boston, MA MSA", "Dallas, TX MSA"]);

  chart.draw(output);

  },

  error : function() {
    console.log("Failure loading data")
  }
});

var testDataTwoDimension = [
  {name: 'A', value: 4},
  {name: 'B', value: -36},
  {name: 'C', value: 19},
  {name: 'D', value: -2},
  {name: 'E', value: 6},
];

var testDataTwoDimension3 = [
  {name: 'A', value: 4},
  {name: 'B', value: -36},
  {name: 'C', value: 60},
  {name: 'D', value: -2},
  {name: 'E', value: 70},
];

var linechart = [
  {year: '2005', value: 4},
  {year: '2006', value: -36},
  {year: '2007', value: 60},
  {year: '2008', value: -2},
  {year: '2009', value: 70},
];

var chart = d3.select('#chart4')
  .append("svg")
  .chart("BarChart")
  .width(500)
  .height(600);

// render it with some data
chart.draw(testDataTwoDimension);



var chart = d3.select('#chart5')
  .append("svg")
  .chart("BarChart");

// render it with some data
chart.draw(testDataTwoDimension3);



</script>
	
</body>
</html>